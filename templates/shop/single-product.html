<span id="userID" hidden>{{userid}}</span>
<span id="productID" hidden>{{product.id}}</span>

<div class="container" id="main-area" style="margin-top: 70px;">
    <div class="row">
        <div class="col-4">
            <section style="width: 18rem;">
                <div class="row">
                    <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img src="{{ROOT_URL}}{{thumbnail}}" class="d-block w-100" alt="...">
                            </div>
                            {% for img in imgs %}
                            {% set c = ROOT_URL ~ img['link'] %}
                            <div class="carousel-item">
                                <img src="{{c}}" class="d-block w-100" alt="..." width: 18rem;>
                            </div>
                            {% endfor %}
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
                            data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
                            data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <h4 class="text-primary"><strong>Categorie:</strong></h4>
                </div>
                {% for cat in category %}
                <span class="badge rounded-pill bg-primary">{{cat.category}}</span>
                <br>
                {% endfor %}
                <hr>
                

            </section>
        </div>

        <div class="col-8">
            <h2 class="text-primary"><strong>{{product.name}}</strong>
                <p class="valutazione">
                    {{star|raw}}
                </p>
            </h2>
            <hr>
            <h4>
                {{product.price}}â‚¬
            </h4>
            <hr>
            {{product.description|raw}}
            <br><br><br>
            <div class="row">
                <div class="col-2">
                    <form method="POST" action="./cart-action.php">
                        <input type="hidden" name="singleProduct" value=1>
                        <input type="text" class="form-control" name="productID" value={{product.id}} hidden>
                        <button class="btn btn-primary" name="product_id" type="submit"
                            value={{product.id}}><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-cart3" viewBox="0 0 16 16">
                                <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l.84 4.479 9.144-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                              </svg></button>
                    </form>
                </div>
                <div class="col-1">
                    <form method="POST" action="./wishlist-action.php">
                        <input type="text" class="form-control" name="productID" value={{product.id}} hidden>
                        {% if email == null %}
                        <button class="btn btn-success" name="wishlist" type="submit" disabled
                            value={{product.id}}><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-bookmark-star-fill" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5zM8.16 4.1a.178.178 0 0 0-.32 0l-.634 1.285a.178.178 0 0 1-.134.098l-1.42.206a.178.178 0 0 0-.098.303L6.58 6.993c.042.041.061.1.051.158L6.39 8.565a.178.178 0 0 0 .258.187l1.27-.668a.178.178 0 0 1 .165 0l1.27.668a.178.178 0 0 0 .257-.187L9.368 7.15a.178.178 0 0 1 .05-.158l1.028-1.001a.178.178 0 0 0-.098-.303l-1.42-.206a.178.178 0 0 1-.134-.098L8.16 4.1z"/>
                              </svg></button>
                        {% else %}
                        <button class="btn btn-success" name="wishlist" type="submit"
                            value={{product.id}}><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-bookmark-star-fill" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5zM8.16 4.1a.178.178 0 0 0-.32 0l-.634 1.285a.178.178 0 0 1-.134.098l-1.42.206a.178.178 0 0 0-.098.303L6.58 6.993c.042.041.061.1.051.158L6.39 8.565a.178.178 0 0 0 .258.187l1.27-.668a.178.178 0 0 1 .165 0l1.27.668a.178.178 0 0 0 .257-.187L9.368 7.15a.178.178 0 0 1 .05-.158l1.028-1.001a.178.178 0 0 0-.098-.303l-1.42-.206a.178.178 0 0 1-.134-.098L8.16 4.1z"/>
                              </svg></button>
                        {% endif %}
                    </form>
                </div>
            </div>

        </div>

    </div>

    <div class="row"><br></div>
    <div class="row"><br></div>
    <div class="row">
        <!-- Tabella recensioni -->
        <div class="col-12">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
                <span class="text-primary"><strong>Recensioni</strong></span>
            </h4>

            <div class="row">
                <div class="col-lg-12 col-6">
                    <form class="card p-2">
                        <div class="input-group">
                            <input type="text" class="form-control" id="floatingInput"
                                placeholder="Cerca tra le recensioni">
                            <!-- Button trigger modal -->
                            {% if check %}
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal"
                                data-whatever="update" {% if not email %} disabled {% endif %}>
                                Modifica la tua recensione
                            </button>
                            {% else %}
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal"
                                data-whatever="add" {% if not email %} disabled {% endif %}>
                                Aggiungi una recensione
                            </button>
                            {% endif %}
                        </div>
                    </form>
                </div>
            </div>

            <span id="reviews" hidden>
                {{json_review|raw}}
            </span>


            {% if reviews == 0 %}

            <ul class="list-group mb-3">
                <li class="list-group-item d-flex justify-content-between lh-sm p-4">
                    <div class="row w-100">
                        <div class="col-lg-12 col-6">
                            <h5 class="my-0 text-muted">Nessuna recensione presente, scrivi tu la prima!</h5>
                        </div>
                    </div>
                </li>
            </ul>

            {% else %}

            {% for review in reviews %}
            {% for user in users %}

            {% set c = ROOT_URL ~ user.img %}
            <ul class="list-group mb-3">
                <li class="list-group-item d-flex justify-content-between lh-sm p-4">
                    <div class="row w-100">
                        <div class="col-lg-2 col-6 text-center">
                            <img class="rounded-circle" src="{{c}}" alt="immagine" width=100px></img>
                            </br>
                            </br>
                            <span class="my-0 text-primary"><small>
                                    {{user.name}}
                                </small></span>
                        </div>
                        <div class="col-lg-10 col-6">
                            <h5 class="my-0 text-primary"><strong>
                                    {{review.title}}
                                </strong>
                                <span class="valutazione">

                                    {% for i in 1..review.vote %}
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-star-fill" viewBox="0 0 16 16">
                                        <path
                                            d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                                    </svg>
                                    {% endfor %}

                                </span>
                            </h5>
                            <span class="my-0 text-muted"><small>
                                    {{review.message}}
                                </small></span>
                        </div>
                    </div>
                </li>
            </ul>
            {% endfor %}
            {% endfor %}
            {% endif %}
        </div>
    </div>
</div>


<!-- Finestra di dialogo per la scrittura della recensione -->
<!-- Modal -->
<form method="POST" action="./review-action.php">
    <div class="modal" id="modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="text-primary"><strong id="modalTitle">Inserisci una recensione</strong></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"></span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Titolo</p>
                    <input type="text" class="form-control" name="title" id="title" placeholder="Inserisci un titolo">
                    <input type="text" class="form-control" name="productID" value={{product.id}} hidden>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <ul class="ratings">
                            <li class="star" value="5"></li>
                            <li class="star" value="4"></li>
                            <li class="star" value="3"></li>
                            <li class="star" value="2"></li>
                            <li class="star" value="1"></li>
                            <input type="hidden" name="vote" id="starValue" value=1></input>
                        </ul>
                    </div>
                    <div class="modal-body">
                        <p>Descrizione</p>
                        <textarea class="form-control" name="message" id="message" rows="4"
                            placeholder="Inserisci una recensione"></textarea>
                    </div>
                    <div class="modal-footer">
                        <button id="modalBtn" type="submit" class="btn btn-primary" name="add">Invia</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Chiudi</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>